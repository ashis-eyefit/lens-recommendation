<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Lens Recommendation</title>
  <style>
    .branding-header {
      display: flex;
      flex-direction: column;         /* stack logo + title vertically */
      align-items: center;            /* center horizontally */
      justify-content: center;
      margin: 30px auto;
      text-align: center;
    }

    .branding-logo {
      height: 120px;                   /* larger logo */
      width: auto;
      margin-bottom: 10px;
    }

    .branding-title {
      font-size: 40px;                /* slightly bigger text */
      color: #222;
      font-weight: 700;
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
    }
   body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #dff1f4;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .container {
      max-width: 700px;
      background: rgb(235, 241, 219);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    input, select, textarea {
      width: 100%;
      padding: 5px;
      margin: 10px 0;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      border-radius: 5px;
    }
    button:hover {
      background: #0056b3;
    }
    .result {
      margin-top: 20px;
      padding: 10px;
      background-color: #e8f5e9;
      border-left: 5px solid #4caf50;
    }
    .question-group {
      margin-bottom: 20px;
    }

    .question-label {
      font-weight:bold;
      margin-bottom: 8px;
      display: block;
      font-size: 16px;
    }

    .checkbox-box {
    border: 1px solid #cdcbcb;
    border-radius: 8px;
    padding: 15px;
    background-color: #ffffff;
    display: flex;
    flex-direction: column;
    }
    .checkbox-item {
    display: flex;
    gap: 8px;
    align-items: flex-start;
    margin-bottom: 10px;
    }

    .checkbox-item input[type="checkbox"] {
    margin-top: 3px;
    flex-shrink: 0;
    width: 18px;
    height: 18px;
    }

    .checkbox-item label {
    flex-grow: 1;
    margin-left: 10px;
    line-height: 1.5;
    word-break: break-word;
    }
    .checkbox-box {
    max-width: 100%;
    }
    .checkbox-item label {
    max-width: 90%;
    }
    @media screen and (max-width: 768px) {
    .container {
        padding: 15px;
    }

    input, select, textarea, button {
        font-size: 16px;
    }

    .checkbox-item label {
        font-size: 15px;
        line-height: 1.4;
    }

    .checkbox-box {
        padding: 12px;
    }
    }
    .lens-result-grid {
    display: flex;
    gap: 20px;
    margin-top: 20px;
    flex-wrap: wrap;
  }

  .lens-type-card, .coating-feature-card {
    flex: 1 1 45%;
    border: 1px solid #ccc;
    padding: 15px;
    border-radius: 10px;
    background: #fafafa;
    box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
  }

  @media screen and (max-width: 768px) {
    .lens-type-card, .coating-feature-card {
      flex: 1 1 100%;
    }
  }
  ul {
    list-style: none;
    padding-left: 1em;
  }

  ul li {
    margin-bottom: 6px;
  }


  </style>
</head>
<body>
 
<div class="container">
   <div class="branding-header">
      <img src="assets/branding_logo.jpg" alt="Brand Logo" class="branding-logo">
      <h1 class="branding-title">LENS LAB</h1>
      <h2>Experience The Intelligence</h2>
   </div>
  
    <form id="lensForm">
    <!-- Name ,Age, Contact Number, Email -->
    <label for="name" class="question-label">Your Name:</label>
    <input type="text" id="name" name="name" required>

    <label for="age" class="question-label">Your Age:</label>
    <input type="number" id="age" name="age" min="0" required>
    
    <label for="contact" class="question-label">Your Contact Number:</label>
    <input type="text" id="contact-number" name="contact-number"  required>

    <label for="email" class="question-label">Your Email ID:</label>
    <input type="text" id="email" name="email">


    <!--wear glass or not-->
    <label class="question-label">Do you wear glasses or contacts?</label>
    <select name="usesGlassesOrContacts" id="usesGlassesOrContacts">
      <option value="Yes">Yes</option>
      <option value="No" selected>No</option>
    </select>
    <!--consulting frequency-->
    <label class="question-label">How often do you visit the eye doctor?</label>
    <select name="consultationFrequency" id="consultationFrequency">
      <option>Weekly</option>
      <option>Monthly</option>
      <option>In every 2 - 4 months</option>
      <option>Half yearly</option>
      <option>yearly</option>
      <option selected>Never</option>
    </select>

    <!-- Eye-related Symptoms -->
    <div class="question-group">
        <label class="question-label">Do you have any eye-related symptoms?</label>
        <div class="checkbox-box" id="symptoms-checkboxes">
            <div class="checkbox-item"><input type="checkbox" value="blurry vision (especially in the evening)"> blurry vision (especially in the evening)</div>
            <div class="checkbox-item"><input type="checkbox" value="eye strain after screen use"> eye strain after screen use</div>
            <div class="checkbox-item"><input type="checkbox" value="dry eyes"> dry eyes</div>
            <div class="checkbox-item"><input type="checkbox" value="red eyes"> red eyes</div>
            <div class="checkbox-item"><input type="checkbox" value="frequent blinking"> frequent blinking</div>
            <div class="checkbox-item"><input type="checkbox" value="difficulty focusing on near objects"> difficulty focusing on near objects</div>
            <div class="checkbox-item"><input type="checkbox" value="watery eyes"> watery eyes</div>
            <div class="checkbox-item"><input type="checkbox" value="sensitivity to light"> sensitivity to light</div>
            <div class="checkbox-item"><input type="checkbox" value="frequent eye rubbing"> frequent eye rubbing</div>
            <div class="checkbox-item"><input type="checkbox" value="double vision"> double vision</div>
            <div class="checkbox-item"><input type="checkbox" value="headaches after reading or screen time"> headaches after reading or screen time</div>
            <div class="checkbox-item"><input type="checkbox" value="eye pain or discomfort"> eye pain or discomfort</div>
            <div class="checkbox-item"><input type="checkbox" value="difficulty tracking moving objects"> difficulty tracking moving objects</div>
            <div class="checkbox-item"><input type="checkbox" value="squinting often"> squinting often</div>
            <div class="checkbox-item"><input type="checkbox" id="symptoms-other-checkbox" value="Other"> Other (please specify)</div>

            <!-- Other input field -->
            <div class="other-input" id="symptoms-other-input-div">
                <input type="text" id="symptoms-other-text" placeholder="Enter other symptoms with Comma-separated e.g. blurry vision, dry eyes" />
            </div>
        </div>
    </div>

    <!--sleep hours-->
    <label class="question-label">How many hours do you usually sleep at night?</label>
    <input type="number" name="sleepHours" id="sleepHours" value="8" min="0" max="24">
    <!--hydration-->
    <label class="question-label">How regularly do you stay hydrated during the day?</label>
    <select name="hydrationFrequency" id="hydrationFrequency">
      <option>Rarely</option>
      <option>Occasionally</option>
      <option selected>Regularly</option>
      <option>Very Frequently</option>
    </select>
    <!--screen time-->
    <label class="question-label">What is your average daily screen time?</label>
    <select name="screenTime" id="screenTime">
      <option>1</option>
      <option>2</option>
      <option>3</option>
      <option>4</option>
      <option>5</option>
      <option>6</option>
      <option>7</option>
      <option>8 or More than 8</option>
    </select>
    <!--screen break-->
    <label class="question-label">How many minutes break do you take per hour of digital screen use?</label>
    <select name="screenBreakTime" id="screenBreakTime">
      <option>10</option>
      <option>15</option>
      <option selected>20</option>
      <option>25</option>
      <option>30</option>
    </select>
    <!--screen mode-->
    <label class="question-label">Do you use the screen with dark mode?</label>
    <select name="isScreenDarkMode" id="isScreenDarkMode">
      <option>Yes</option>
      <option selected>No</option>
    </select>
    <!--screen brightness-->
    <label class="question-label">What is you preferred screen brightness</label>
    <select name="screenBrightness" id="screenBrightness">
      <option>low</option>
      <option selected>medium</option>
      <option>high</option>
    </select>
    <!--reading time-->
    <label class="question-label">What is your average daily reading time (in hours)?</label>
    <input type="number" name="readingTime"  id="readingTime" value="1.5" step="0.1">
    <!--outdoor time-->
    <label class="question-label">How many hours per day do you spend outdoors?</label>
    <input type="number" name="outdoorTime" id="outdoorTime" value="1" step="0.1">
    <!--diagnosed conditions-->
    <div class="question-group">
        <label class="question-label">Do you have any earlier diagnosed eye conditions?</label>
        <div class="checkbox-box" id="diagnosed-checkboxes">
            <div class="checkbox-item">
                <input type="checkbox" id="cond1" name="diagnosedConditions" value="‚ùå None">
                <label for="cond1">‚ùå None</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="cond2" name="diagnosedConditions" value="üëì Myopia (Near-sightedness)">
                <label for="cond2">üëì Myopia (Near-sightedness)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="cond3" name="diagnosedConditions" value="üî≠ Hyperopia (Far-sightedness)">
                <label for="cond3">üî≠ Hyperopia (Far-sightedness)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="cond4" name="diagnosedConditions" value="üìê Astigmatism (Blurred/distorted vision)">
                <label for="cond4">üìê Astigmatism (Blurred/distorted vision)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="cond5" name="diagnosedConditions" value="üëÄ Strabismus (Crossed eyes)"">
                <label for="cond5">üëÄ Strabismus (Crossed eyes)"</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="cond6" name="diagnosedConditions" value="üò¥ Amblyopia (Lazy eye)">
                <label for="cond6">üò¥ Amblyopia (Lazy eye)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="cond7" name="diagnosedConditions" value="üòï Ptosis (Drooping eyelid)">
                <label for="cond7">üòï Ptosis (Drooping eyelid)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="cond8" name="diagnosedConditions" value="üë∂‚òÅÔ∏è Congenital Cataract (Clouded lens at birth)">
                <label for="cond8">üë∂‚òÅÔ∏è Congenital Cataract (Clouded lens at birth)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="cond9" name="diagnosedConditions" value="üë∂üíß Congenital Glaucoma (High eye pressure at birth)">
                <label for="cond9">üë∂üíß Congenital Glaucoma (High eye pressure at birth)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="cond10" name="diagnosedConditions" value="üîÅ Nystagmus (Involuntary eye movement)">
                <label for="cond10">üîÅ Nystagmus (Involuntary eye movement)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="cond11" name="diagnosedConditions" value="üåà‚ùå Colour Vision Deficiency (Trouble seeing certain colors)">
                <label for="cond11">üåà‚ùå Colour Vision Deficiency (Trouble seeing certain colors)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="cond12" name="diagnosedConditions" value="üë∂ü©∫ Retinopathy of Prematurity (ROP)(Retinal issues in premature babies)">
                <label for="cond12">üë∂ü©∫ Retinopathy of Prematurity (ROP)(Retinal issues in premature babies)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="cond13" name="diagnosedConditions" value="ü§ß Allergic Conjunctivitis (Eye allergy/redness/itching)">
                <label for="cond13">ü§ß Allergic Conjunctivitis (Eye allergy/redness/itching)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="cond14" name="diagnosedConditions" value="üíªüò´ Digital Eye Strain / Screen-Related Fatigue">
                <label for="cond14">üíªüò´ Digital Eye Strain / Screen-Related Fatigue</label>
            </div>
            <!-- other option -->
            <div class="checkbox-item">
                <input type="checkbox" id="diagnosed-other-checkbox" name="diagnosedConditions" value="Other">
                <label for="diagnosed-other-checkbox">Other (Please write the diagnosed conditions)</label>
            </div>
            <div class="other-input" id="diagnosed-other-input">
                <input type="text" id="symptoms-other-text" placeholder="Enter other diagnosed conditions (Comma-separated e.g. Myopia, Astigmatism)">
            </div>
        </div>
    </div>
    <!--family diagnosed condition-->
    <div class="question-group">
        <label class="question-label">Is there any family history of diagnosed eye conditions (from either parent)?</label>
        <div class="checkbox-box" id="parent-diagnosed-checkboxes">
            <div class="checkbox-item">
                <input type="checkbox" id="p_cond1" name="parentsDiagnosedConditions" value="None">
                <label for="p_cond1">None</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="p_cond2" name="parentsDiagnosedConditions" value="Myopia">
                <label for="p_cond2">Myopia</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="p_cond3" name="parentsDiagnosedConditions" value="Hypermetropia">
                <label for="p_cond3">Hypermetropia</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="p_cond4" name="parentsDiagnosedConditions" value="Astigmatism">
                <label for="p_cond4">Astigmatism</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="p_cond5" name="parentsDiagnosedConditions" value="Any known congenital eye diseases">
                <label for="p_cond5">Any known congenital eye diseases</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="p_cond6" name="parentsDiagnosedConditions" value="Colour blindness">
                <label for="p_cond6">Colour blindness</label>
            </div>
            <!-- other option -->
            <div class="checkbox-item">
                <input type="checkbox" id="parent-other-checkbox" name="parentsDiagnosedConditions" value="Other">
                <label for="parent-other-checkbox">Other (Please write the parents' diagnosed conditions)</label>
            </div>
            <div class="parents-other-input" id="parents-diagnosed-other-input">
                <input type="text" id="parent-other-text" placeholder="Enter other parents diagnosed conditions (Comma-separated e.g. Myopia, Astigmatism)">
            </div>
        </div>
    </div>
    <!-- vision aid Preferences -->
    <div class="question-group">
      <label class="question-label">What lens features do you prefer?</label>
    <div>
      <div class="checkbox-box" id="preferences-checkboxes">
        <div class="checkbox-item"><input type="checkbox" value="Blue Light Protection (reduces screen glare)"> Blue Light Protection (reduces screen glare)</div>
        <div class="checkbox-item"><input type="checkbox" value="Scratch Resistant (durable for daily wear)"> Scratch Resistant (durable for daily wear)</div>
        <div class="checkbox-item"><input type="checkbox" value="Anti Reflective (night driving & clarity)"> Anti Reflective (night driving & clarity)</div>
        <div class="checkbox-item"><input type="checkbox" value="UV Protection (sunlight protection)"> UV Protection (sunlight protection)</div>
        <div class="checkbox-item"><input type="checkbox" value="Anti Static (dust repelling)"> Anti Static (dust repelling)</div>
        <div class="checkbox-item"><input type="checkbox" value="Super Hydrophobic (water/smudge resistant)"> Super Hydrophobic (water/smudge resistant)</div>
        <div class="checkbox-item"><input type="checkbox" value="Achromatic (sharp vision & true colors)"> Achromatic (sharp vision & true colors)</div>
        <div class="checkbox-item"><input type="checkbox" value="Driving Lens (night vision enhancement)"> Driving Lens (night vision enhancement)</div>
        <div class="checkbox-item"><input type="checkbox" value="Photochromic Lens (auto dark in sunlight)"> Photochromic Lens (auto dark in sunlight)</div>
        <div class="checkbox-item"><input type="checkbox" id="preferences-other-checkbox" value="Other"> Other (please specify)</div>
        <div class="other-input" id="preferences-other-input-div">
          <input type="text" id="preferences-other-text" placeholder="Enter custom feature(s), comma-separated" />
        </div>
      </div>
    </div>
  </div>
    <!-- Lens recommentdation button -->
    <button type="submit">Get Lens Recommendation</button>
    </form>
    <div id="result" class="result" style="display:none;"></div>
    <div id="status-message" style="margin-top: 15px; font-weight: bold; color: #333;"></div>
  </div>

<script>
  // Utility to extract checkbox values with optional "Other"
  function getCheckboxValues(containerId, otherCheckboxId, otherInputId) {
    const container = document.getElementById(containerId);
    const checkboxes = container.querySelectorAll('input[type="checkbox"]');
    const selected = [];

    checkboxes.forEach(cb => {
      if (cb.checked && cb.value !== "Other") {
        selected.push(cb.value);
      }
    });

    const otherCheckbox = document.getElementById(otherCheckboxId);
    const otherInput = document.getElementById(otherInputId);
    if (otherCheckbox && otherCheckbox.checked && otherInput.value.trim()) {
      selected.push(...otherInput.value.split(",").map(s => s.trim()));
    }

    return selected;
  }

  // Toggle visibility of "Other" input field
  function setupOtherToggle(checkboxId, inputWrapperId) {
    const checkbox = document.getElementById(checkboxId);
    const inputWrapper = document.getElementById(inputWrapperId);
    checkbox.addEventListener("change", () => {
      inputWrapper.style.display = checkbox.checked ? "block" : "none";
      if (!checkbox.checked) {
        const input = inputWrapper.querySelector("input");
        if (input) input.value = "";
      }
    });
  }

  // Hook all "Other" toggles
  setupOtherToggle("symptoms-other-checkbox", "symptoms-other-input-div");
  setupOtherToggle("diagnosed-other-checkbox", "diagnosed-other-input");
  setupOtherToggle("parent-other-checkbox", "parents-diagnosed-other-input");
  setupOtherToggle("preferences-other-checkbox", "preferences-other-input-div");


  // Main form submit
    window.addEventListener("DOMContentLoaded", function () {
    document.getElementById("lensForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        
        const statusDiv = document.getElementById("status-message");
        statusDiv.style.display = "block";
        statusDiv.innerHTML = "‚è≥ Submitting data... Generating your personalized lens recommendation.";

        try {
        const data = {
            name: document.getElementById("name").value,
            age: parseInt(document.getElementById("age").value),
            contactNumber: document.getElementById("contact-number").value,
            emailID: document.getElementById("email").value,
            usesGlassesOrContacts: document.querySelector('input[name="usesGlassesOrContacts"]:checked')?.value || "No",
            consultationFrequency: document.getElementById("consultationFrequency").value,
            symptoms: getCheckboxValues("symptoms-checkboxes", "symptoms-other-checkbox", "symptoms-other-text"),
            sleepHours: parseFloat(document.getElementById("sleepHours").value),
            hydrationFrequency: document.getElementById("hydrationFrequency").value,
            screenTime: document.getElementById("screenTime").value,
            screenBreakTime: parseInt(document.getElementById("screenBreakTime").value),
            isScreenDarkMode: document.getElementById("isScreenDarkMode").value,
            screenBrightness: document.getElementById("screenBrightness").value,
            readingTime: parseFloat(document.getElementById("readingTime").value),
            outdoorTime: parseFloat(document.getElementById("outdoorTime").value),
            diagnosedConditions: getCheckboxValues("diagnosed-checkboxes", "diagnosed-other-checkbox", "diagnosed-other-text"),
            familyHistory: getCheckboxValues("parent-diagnosed-checkboxes", "parent-other-checkbox", "parent-other-text"),
            preferences: getCheckboxValues("preferences-checkboxes", "preferences-other-checkbox", "preferences-other-text")
        };
        // Debugging in console output
        console.log("Sending data:", data);

        const response = await fetch("http://localhost:8002/recommend", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });

        if (!response.ok) throw new Error("Request failed");

        const result = await response.json();
        

        // Save lens image URLs globally for toggle function
        window.latestLensImageURL_main = result.lens_image_url;
        window.latestLensImageURL_coating = result.coating_image_url;



        // Render textual result only (not images yet)
        document.getElementById("result").style.display = "block";
        document.getElementById("result").innerHTML = `
          <h3>üéØ Recommended Lens: ${result.lens_name}</h3>
          <p><strong>Description:</strong>${bulletToList(result.description)}</p>
          <p><strong>Benefits:</strong>${bulletToList(result.benefits)}</p>
          <button onclick="toggleImage()" style="margin-top: 10px;">üñºÔ∏è Show Lens Image</button>
          <div id="lensImageContainer" style="display: none; margin-top: 15px;">
            <div>
              <h3> Lens Image </h3>
              <img id="lensImageMain" src="" alt="Main Lens" style="max-width: 240px; margin-right: 20px; border-radius: 6px;">
            </div>
            <div>
              <h3>Coating Style (Transparent)</h3>
              <img id="lensImageCoating" src="" alt="Coating" style="max-width: 240px; border-radius: 6px;">
            </div>
          </div>
        `;



          //////////DEBUGGING PART
          console.log("Trying to show image from:", window.latestLensImageURL);


        statusDiv.innerHTML = "‚úÖ Recommendation generated successfully.";
        
        

        } catch (err) {
        statusDiv.innerHTML = "‚ùå Something went wrong. Kindly, check your input data.";
        console.error(err);
        }
    });
    });

      function toggleImage() {
      const container = document.getElementById("lensImageContainer");
      const imgMain = document.getElementById("lensImageMain");
      const imgCoating = document.getElementById("lensImageCoating");

      container.style.display = "block";
      imgMain.src = window.latestLensImageURL_main;
      imgCoating.src = window.latestLensImageURL_coating;
    }
    // Utility to convert üîµ bullet text string into HTML list
    function bulletToList(text) {
      return `<ul>` + text
        .split('üîµ')
        .map(item => item.trim())
        .filter(Boolean)
        .map(item => `<li>üîµ ${item}</li>`)
        .join('') + `</ul>`;
    }

</script>
</body>
</html>